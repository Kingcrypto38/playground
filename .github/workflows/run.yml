---
name: "▶️ Playground"

on:
  workflow_run:
    workflows: [Run Tests]
    types:
      - completed
  push:
    paths:
      - "profiles/**"

jobs:
  authors:
    runs-on: ubuntu-latest
    outputs:
      matrix: ${{ steps.set-authors.outputs.authors }}
    steps:
      - name: ⤵️ Check out code from GitHub
        uses: actions/checkout@v3
      - name: "✨ Set matrix output"
        id: set-authors
        run: |
          MATRIX="$(find * \( -name .zshrc -o -name zshrc.zsh \) -type f -exec dirname {} \; | jq -ncR '{"author": inputs}')"
          echo "MATRIX=${MATRIX}" >&2
          echo "::set-output name=authors::${MATRIX}"
  play:
    needs: authors
    strategy:
      fail-fast: false
      matrix: ${{ fromJSON(needs.authors.outputs.authors) }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: "▶️ ${{matrix.author}}"
        run: docker build --build-arg FOLDER="${{matrix.author}}" --build-arg TERM="${TERM}" -t "zi/${{ matrix.author }}" .
